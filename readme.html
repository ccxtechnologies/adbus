

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>python-adbus &mdash; python-adbus 1.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="adbus" href="modules.html" />
    <link rel="prev" title="Welcome to python-adbus’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> python-adbus
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">python-adbus</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#status">Status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#links">Links</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-installing">Building / Installing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unit-tests">Unit-Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#server-examples">Server Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#object-example">Object Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-multiple-properties">Setting Multiple Properties</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#client-examples">Client Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#accessing-remote-interface-via-a-proxy">Accessing Remote Interface via a Proxy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#style-guide">Style Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="modules.html">adbus</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">python-adbus</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>python-adbus</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/readme.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="python-adbus">
<h1>python-adbus<a class="headerlink" href="#python-adbus" title="Permalink to this headline">¶</a></h1>
<p>D-Bus Binding for Python utilizing the Python’s asyncio module.</p>
<div class="section" id="status">
<h2>Status<a class="headerlink" href="#status" title="Permalink to this headline">¶</a></h2>
<a class="reference external image-reference" href="https://www.codacy.com/app/ccxtechnologies/python-adbus?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=ccxtechnologies/python-adbus&amp;amp;utm_campaign=Badge_Grade"><img alt="https://api.codacy.com/project/badge/Grade/c66c19cdcadd4c83bc4b70596d65aa7a" src="https://api.codacy.com/project/badge/Grade/c66c19cdcadd4c83bc4b70596d65aa7a" /></a>
<a class="reference external image-reference" href="https://www.codacy.com/app/ccxtechnologies/python-adbus?utm_source=github.com&amp;amp;utm_medium=referral&amp;amp;utm_content=ccxtechnologies/python-adbus&amp;amp;utm_campaign=Badge_Coverage"><img alt="https://api.codacy.com/project/badge/Coverage/c66c19cdcadd4c83bc4b70596d65aa7a" src="https://api.codacy.com/project/badge/Coverage/c66c19cdcadd4c83bc4b70596d65aa7a" /></a>
</div>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://ccxtechnologies.github.io/adbus">Documentation</a></li>
<li><a class="reference external" href="https://github.com/ccxtechnologies/adbus">Project Page</a></li>
<li><a class="reference external" href="https://github.com/ccxtechnologies/adbus/issues">Issues</a></li>
</ul>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Python &gt;= 3.7</li>
<li>libsystemd &gt;= 232 (don’t need systemd, just libsystemd which is a separate package)</li>
<li>Cython &gt;= 0.25.2 (only required to regenerate sdbus.c, if you make any changes)</li>
</ol>
</div>
<div class="section" id="building-installing">
<h2>Building / Installing<a class="headerlink" href="#building-installing" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>To build in place for development python ./setup.py build_ext –inplace</li>
<li>The html documents are stored in gh-pages branch, so that GitHub will
serve them as a GitHub Pages. To build them:
1. check out the gh-pages branch into ../python-adbus/html
2. cd into docs
3. sphinx-apidoc -o source/ ../adbus
4. make html</li>
</ul>
</div>
<div class="section" id="unit-tests">
<h2>Unit-Tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h2>
<p>NOTE: Some test-cases require the busctl tool from systemd.</p>
<ul class="simple">
<li>To run a specific unit-test from the root directory (eg.): python -m
unittest tests.test_sdbus_method.Test.test_method_single_str</li>
<li>To run a specific unit-test module from the root directory (eg.):
python -m unittest tests.test_sdbus_method</li>
<li>To run all unit-tests from the root directory: python -m unittest
discover</li>
</ul>
</div>
<div class="section" id="server-examples">
<h2>Server Examples<a class="headerlink" href="#server-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="object-example">
<h3>Object Example<a class="headerlink" href="#object-example" title="Permalink to this headline">¶</a></h3>
<p>This is an example of an object, which can be connected to a service.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">adbus</span>
<span class="kn">import</span> <span class="nn">typing</span>

<span class="k">class</span> <span class="nc">ExampleClass</span><span class="p">(</span><span class="n">adbus</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>

    <span class="n">signal1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">adbus</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>
    <span class="n">signal2</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">adbus</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">Signal</span><span class="p">()</span>

    <span class="n">property1</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">adbus</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">Property</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">property2</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">adbus</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">Property</span><span class="p">([</span><span class="s1">&#39;rr&#39;</span><span class="p">,</span> <span class="s1">&#39;ff&#39;</span><span class="p">],</span> <span class="n">deprectiated</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">service</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;/xxx/yyy&#39;</span><span class="p">,</span> <span class="n">interface</span><span class="o">=</span><span class="s1">&#39;yyy.xxx&#39;</span><span class="p">)</span>

    <span class="nd">@adbus.method</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">gg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">+</span> <span class="mi">10</span>

    <span class="k">def</span> <span class="nf">do_something</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">signal1</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="setting-multiple-properties">
<h3>Setting Multiple Properties<a class="headerlink" href="#setting-multiple-properties" title="Permalink to this headline">¶</a></h3>
<p>It’s possible to set multiple properties at the same time, this will defer the property
update signal, and send one signal for all property changes. It’s good practice to use
this when changing multiple properties, it will reduce traffic on the D-Bus.</p>
<p>NOTE: Must be running in a loop.</p>
</div>
</div>
<div class="section" id="client-examples">
<h2>Client Examples<a class="headerlink" href="#client-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="accessing-remote-interface-via-a-proxy">
<h3>Accessing Remote Interface via a Proxy<a class="headerlink" href="#accessing-remote-interface-via-a-proxy" title="Permalink to this headline">¶</a></h3>
<p>It’s possible to map a remote interface to a local instantiated class using a Proxy.</p>
<p>NOTE: If the even loop isn’t running no signals will caught, and properties will not
cache (i.e. will read on every access instead of tracking the property changes signals)</p>
<p><strong>This is a protoype to see how it looks, it hasn’t been implemented yet.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="o">=</span> <span class="n">adbus</span><span class="o">.</span><span class="n">Service</span><span class="p">(</span><span class="n">bus</span><span class="o">=</span><span class="s1">&#39;session&#39;</span><span class="p">)</span>
<span class="n">proxy</span> <span class="o">=</span> <span class="n">adbus</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">Proxy</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="s1">&#39;com.example.xxx&#39;</span><span class="p">,</span> <span class="s1">&#39;/com/example/Service1&#39;</span><span class="p">,</span>
    <span class="n">interface</span><span class="o">=</span><span class="s1">&#39;com.example.service.unit&#39;</span><span class="p">)</span>

<span class="n">async</span> <span class="k">def</span> <span class="nf">proxy_examples</span><span class="p">():</span>
  <span class="n">await</span> <span class="n">proxy</span><span class="o">.</span><span class="n">update</span><span class="p">()</span> <span class="c1"># initialize the proxy</span>

  <span class="c1"># == Access Properties</span>
  <span class="n">await</span> <span class="n">proxy</span><span class="o">.</span><span class="n">remote_propertyX</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">await</span> <span class="n">proxy</span><span class="o">.</span><span class="n">remote_propertyY</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>

  <span class="c1"># == or</span>
  <span class="n">await</span> <span class="n">proxy</span><span class="o">.</span><span class="n">remote_propertyX</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="n">await</span> <span class="n">proxy</span><span class="o">.</span><span class="n">remote_propertyY</span><span class="p">())</span>

  <span class="c1"># == Access Methods</span>
  <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">remote_method_foo</span><span class="p">(</span><span class="s2">&quot;some info&quot;</span><span class="p">))</span> <span class="c1"># don&#39;t wait for result</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">await</span> <span class="n">proxy</span><span class="o">.</span><span class="n">remote_method_bar</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">)</span> <span class="c1"># wait for result</span>

  <span class="c1"># == Add a Coroutine to a Signal</span>
  <span class="n">async</span> <span class="k">def</span> <span class="nf">local_method</span><span class="p">(</span><span class="n">signal_data</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">signal_data</span><span class="p">)</span>
  <span class="n">proxy</span><span class="o">.</span><span class="n">remote_signal</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">local_method</span><span class="p">)</span>

  <span class="c1"># == or</span>
  <span class="n">proxy</span><span class="o">.</span><span class="n">remote_signal</span><span class="p">(</span><span class="n">local_method</span><span class="p">)</span>

  <span class="c1"># == Remove a Coroutine to a Signal</span>
  <span class="n">proxy</span><span class="o">.</span><span class="n">remote_signal</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">local_method</span><span class="p">)</span>

  <span class="c1"># == or (if already added)</span>
  <span class="n">proxy</span><span class="o">.</span><span class="n">remote_signal</span><span class="p">(</span><span class="n">local_method</span><span class="p">)</span>

  <span class="c1"># == Access a method using a different interface name</span>
  <span class="n">proxy</span><span class="p">[</span><span class="s1">&#39;com.example.service.serve&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">remote_method_800</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

  <span class="c1"># == Create a new proxy from a node in the proxy</span>
  <span class="n">proxy_new</span> <span class="o">=</span> <span class="n">await</span> <span class="n">proxy</span><span class="p">(</span><span class="s1">&#39;Test&#39;</span><span class="p">)</span>

  <span class="c1"># == Loop through all nodes in a proxy</span>
  <span class="n">sum_cnt</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">async</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">proxy</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span>
          <span class="n">sum_cnt</span> <span class="o">+=</span> <span class="n">await</span> <span class="n">node</span><span class="o">.</span><span class="n">count</span>
      <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
          <span class="k">pass</span>

  <span class="c1"># == set multiple properties in one message (if linked to an adbus based server)</span>
  <span class="n">async</span> <span class="k">with</span> <span class="n">proxy</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
      <span class="n">p</span><span class="o">.</span><span class="n">property1</span> <span class="o">=</span> <span class="s2">&quot;some data&quot;</span>
      <span class="n">p</span><span class="o">.</span><span class="n">property2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">proxy_examples</span><span class="p">())</span>
<span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="style-guide">
<h2>Style Guide<a class="headerlink" href="#style-guide" title="Permalink to this headline">¶</a></h2>
<p>For a consistent style all code is run through yapf using the Facebook style:</p>
<p>All docstrings are in the google style.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="modules.html" class="btn btn-neutral float-right" title="adbus" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to python-adbus’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, CCX Technolgies

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>